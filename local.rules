alert tcp any any -> $HOME_NET 9389 (msg:"SS POLICY Active Directory Web Services"; flow:to_server,established; flags:PA; content:"/ActiveDirectoryWebServices/Windows/Enumeration"; classtype:attempted-recon; sid:1000001;)
alert tcp any any -> $HOME_NET [139,445] (msg:"SS POLICY Remote OpenSCManagerW Request"; flow:to_server,established; content:"SMB"; offset:4; depth:8; content:"|0b 00|"; distance:8; within:2; content:"|00|"; distance:108; content:"|0f 00 00 00 02 00|"; distance:15; within:6; classtype:rpc-portmap-decode; sid:1000002;)
alert tcp any any -> !$FILE_SERVERS [139,445] (msg:"SS POLICY PsExec Service Detected"; flow:to_server,established; flags:PA; content:"|50 00 53 00 45 00 58 00 45 00 53 00 56 00 43 00 2e 00 65 00 78 00 65 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000003; )
alert tcp any any -> $HOME_NET 135 (msg:"SS POLICY DCOM Communication WMI Remote Code Execution"; flow:to_server,established; content:"|18 ad 09 f3 6a d8 d0 11 a0 75 00 c0 4f b6 88 20|"; offset:32; classtype:rpc-portmap-decode; sid:1000004;)
alert tcp any any -> ![10.0.31.40,192.168.47.23,10.32.1.25] 5985 (msg:"SS POLICY WSMan Remote Execution WinRM"; flow:to_server,established; content:"POST"; http_method; content:"/wsman"; http_uri; classtype:rpc-portmap-decode; sid:1000005;)
alert tcp any any -> $HOME_NET 5985 (msg:"SS POLICY WinRM User Agent"; flow:to_server,established; content:"User-Agent: Microsoft WinRM Client"; http_header; classtype:rpc-portmap-decode; sid:1000007;)
alert tcp !$SERVERS any -> $DC_SERVERS 389 (msg:"SS SCAN Behavioral Unusual Port 389 traffic, Potential Scan or Reconnaissance"; flags:PA; detection_filter: track by_src, count 140, seconds 120; classtype:attempted-recon; sid:1000008;)
alert tcp !$DC_SERVERS any -> $DC_SERVERS [49152:65535] (msg:"SS POLICY DCSync Detected"; flow:to_server,established; flags:PA; content:"|00 03 10 00 00 00|"; depth:8; content:"|03 00|"; distance:14; within:2; content:"|09 06 0e|"; distance:0; content:"|05 04|"; distance:5; within:2; classtype:attempted-admin; sid:1000010;)
alert tcp any any -> $HOME_NET 445 (msg:"SS SCAN Behavioral 445 Session Enumeration, Potential Scan or Reconnaissance"; flags:PA; content:"SMB"; offset:4; depth:9; content:"|0b 00|"; distance:8; content:"|00|"; distance:108; content:"|0c 00|"; distance:19; content:"|00 00 02 00|"; distance:0; within:4; content:"|0a 00 00 00|"; distance:32; content:"|ff ff ff ff|"; distance:8; classtype:attempted-recon; sid:1000011;)
alert tcp any any -> !$DC_SERVERS any (msg:"SS POLICY RPC SAMR Request"; flow:to_server,established; flags:PA; content:"|78 00 08 00 00 00 00 00 00 00 00 00 73 00 61 00 6d 00 72 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000016;)
alert tcp any any -> any any (msg:"SS POLICY RPC SVCCTL Request"; flow:to_server,established; content:"|78 00 0c 00 00 00 00 00 00 00 00 00 73 00 76 00 63 00 63 00 74 00 6c 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000017;)
alert tcp any any -> ![$FILE_SERVERS,$DC_SERVERS] any (msg:"SS POLICY RPC SRVSVC Request"; flow:to_server,established; flags:PA; content:"|78 00 0c 00 00 00 00 00 00 00 00 00 73 00 72 00 76 00 73 00 76 00 63 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000018;)
alert tcp any any -> ![$DC_SERVERS] any (msg:"SS POLICY RPC LSARPC Request"; flow:to_server,established; flags:PA; content:"|78 00 0c 00 00 00 00 00 00 00 00 00 6c 00 73 00 61 00 72 00 70 00 63 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000019;)
alert tcp any any -> any any (msg:"SS POLICY RPC ATSVC Request"; flow:to_server,established; flags:PA; content:"|78 00 0a 00 00 00 00 00 00 00 00 00 61 00 74 00 73 00 76 00 63 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000020;)
alert tcp any any -> any any (msg:"SS POLICY RPC FssAgentRpc Request"; flow:to_server,established; flags:PA; content:"|46 00 73 00 73 00 61 00 67 00 65 00 6e 00 74 00 52 00 70 00 63 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000022;)
alert tcp any any -> any any (msg:"SS POLICY RPC EPMAP Request"; flow:to_server,established; flags:PA; content:"|65 00 70 00 6d 00 61 00 70 00 70 00 65 00 72 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000023;)
alert tcp any any -> !$FILE_SERVERS any (msg:"SS POLICY RPC EVENTLOG Request"; flow:to_server,established; flags:PA; content:"|78 00 10 00 00 00 00 00 00 00 00 00 6c 00 65 00 76 00 65 00 6e 00 74 00 6c 00 6f 00 67 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000024;)
alert tcp any any -> any any (msg:"SS POLICY RPC LSASS Request"; flow:to_server,established; flags:PA; content:"|6c 00 73 00 61 00 73 00 73 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000026;)
alert tcp any any -> !$FILE_SERVERS any (msg:"SS POLICY RPC WKSSVC Request"; flow:to_server,established; flags:PA; content:"|78 00 0c 00 00 00 00 00 00 00 00 00 77 00 6b 00 73 00 73 00 76 00 63 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000028;)
alert tcp any any -> any any (msg:"SS POLICY RPC WINLOGONRPC Request"; flow:to_server,established; flags:PA; content:"|77 00 69 00 6e 00 6c 00 6f 00 67 00 6f 00 6e 00 72 00 70 00 63 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000029;)
alert tcp any any -> ![$DC_SERVERS] any (msg:"SS POLICY RPC WINREG Request"; flow:to_server,established; flags:PA; content:"|78 00 0c 00 00 00 00 00 00 00 00 00 77 00 69 00 6E 00 72 00 65 00 67 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000030;)
alert tcp ![$DC_SERVERS,$FILE_SERVERS] any -> any 445 (msg:"SS POLICY Remote PIPE Request"; flow:to_server,established; content:"\\pipe"; offset:0; nocase; content:!"\\spoolss"; content:!"\\HydraLsPipe"; content:!"wkssvc"; content:!"srvsvc"; classtype:rpc-portmap-decode; sid:1000033;)
alert tcp !$SERVERS any -> ![$FILE_SERVERS,$DC_SERVERS] 445 (msg:"SS SCAN Behavioral Unusual Port 445 traffic, Potential Scan or Infection"; flags:S; detection_filter: track by_src, count 15, seconds 60; classtype:misc-activity; sid:1000036;)
alert tcp [$SERVERS] any -> ![$FILE_SERVERS,$DC_SERVERS] 445 (msg:"SS SCAN Behavioral Unusual Port 445 traffic Servers, Potential Scan or Infection"; flags:S; detection_filter: track by_src, count 70 , seconds 60; classtype:misc-activity; sid:1000032;)
alert tcp any any -> [$HOME_NET] 1433 (msg:"SS POLICY Remote SQL Batch Port 1433 traffic"; flags:PA; content:"|01|"; depth:1; classtype:misc-activity; sid:1000037;)
alert tcp any any -> $DC_SERVERS 389 (msg:"SS POLICY SPN Search"; flow:to_server,established; flags:PA; content:"|22 04 14 73 65 72 76 69 63 65 70 72 69 6e 63 69 70 61 6c 6e 61 6d 65 30 84 00 00 00 06 81 04|"; offset:0; classtype:attempted-recon; sid:1000038;)
#alert tcp $DC_SERVERS 389 -> $HOME_NET any (msg:"SS POLICY AdminCount Flag Query"; content:"|30 84 00 00 00 15 04 0a 61 64 6d 69 6e 43 6f 75 6e 74 31 84 00 00 00 03 04 01 31|"; classtype:attempted-recon; sid:1000039;)
#alert tcp any any -> any 88 (msg:"SS POLICY Over-Pash-The-Hash"; flow:to_server,established; content:"|05 a2 03 02 01 0a|"; content:"|30 11 a1 04 02 02|"; content:"|02 01 00|"; classtype:attempted-admin; sid:1000040;)
alert tcp any any -> any 88 (msg:"SS POLICY PAC Attack"; flow:to_server,established; content:"|05 a2 03 02 01 0a|"; content:"|03 02 01|"; distance:0; content:"|30 11 a1 04 02 02 00 80 a2 09 04 07 30 05 a0 03 01 01 00|"; distance:0; classtype:attempted-admin; sid:1000041;)
alert udp any any -> $HOME_NET 1434 (msg:"SS SCAN Behavioral Unusual Port 1434 traffic, Potential Scan SQL Servers"; detection_filter: track by_src, count 10 , seconds 60; classtype:attempted-recon; sid:1000043;)
alert tcp any any -> $DC_SERVERS 445 (msg:"SS POLICY GPP Password Scan"; flow:to_server,established; content:"|05 00|"; content:"|60 00 40 00|"; distance:0; pcre:"/S.c.h.e.d.u.l.e.d.T.a.s.k.s|G.r.o.u.p.s|S.e.r.v.i.c.e.s|D.a.t.a.S.o.u.r.c.e.s/i"; content:"|2e 00 78 00 6d 00 6c 00|"; distance:0; classtype:attempted-recon; sid:1000048;)
alert tcp any any -> $HOME_NET 445 (msg:"SS POLICY Named Pipe Search"; flow:to_server,established; content:"|01 00 00 00|"; content:"|18 00 11 00 ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff|"; distance:0; content:!"|4d 00 73 00 46 00 74 00 65 00 57 00 64 00 73 00|"; content:!"|77 00 69 00 6e 00 72 00 65 00 67 00|"; content:!"|73 00 70 00 6f 00 6f 00 6c 00 73 00 73 00|"; content:!"|56 00 46 00 5f 00 52 00 50 00 43 00 5f 00 50 00 49 00 50 00 45 00|"; content:!"|50 00 72 00 69 00 76 00 61 00 74 00 65 00 41 00 72 00 6b 00 5f 00 4e 00 54 00 5f 00 41 00 75 00 74 00 68 00 65 00 6e 00 74 00 69 00 63 00 61 00 74 00 69 00 6f 00 6e 00 5f 00 50 00 69 00 70 00 65 00|"; classtype:misc-activity; sid:1000049;)
alert tcp any any -> [$HOME_NET] any (msg:"SS POLICY NTLM Authentication Potential Scan\Bruteforce"; flags:PA; content:"|4e 54 4c 4d 53 53 50 00 03 00 00 00|"; offset:0; detection_filter: track by_src, count 3, seconds 60; classtype:attempted-recon; sid:1000051;)
alert tcp any any -> $HOME_NET 445 (msg:"SS POLICY Remote API Service"; flow:to_server,established; flags:PA; content:"|5f 00 41 00 50 00 49 00 5f 00 73 00 65 00 72 00 76 00 69 00 63 00 65 00|"; offset:0; classtype:attempted-recon; sid:1000052;)
alert tcp any any -> $DC_SERVERS 445 (msg:"SS POLICY NetSync Attempt (NetrServerAuthenticate)"; flags:PA; content:"|00 00 1c 00 00 00|"; content:"|c8 00 00 00 01 00 0f 00|"; distance:0; classtype:attempted-recon; sid:1000053;)
alert tcp any any -> ![$FILE_SERVERS] 445 (msg:"SS POLICY Mimikatz String"; flags:PA; content:"|6d 00 69 00 6d 00 69 00 6b 00 61 00 74 00 7a 00|"; offset:0; classtype:attempted-recon; sid:1000054;)
alert tcp any any -> $DC_SERVERS 389 (msg:"SS POLICY SPN Search"; flags:PA; content:"|73 65 72 76 69 63 65 70 72 69 6e 63 69 70 61 6c 6e 61 6c 6e 61 6d 65 30|"; offset:0;  classtype:attempted-recon; sid:1000055;)
alert tcp ![192.168.47.225] any -> $DC_SERVERS 445 (msg:"SS POLICY OpenUser Request"; flags:PA; content:"|00 00 25 00 00 00|"; content:"|1c 00 00 00 01 00 22 00|"; detection_filter: track by_src, count 3, seconds 120; classtype:attempted-recon; sid:1000056;)
alert tcp any any -> $HOME_NET any (msg:"SS POLICY RPC NTSVCS Request"; flow:to_server,established; flags:PA; content:"|6e 00 74 00 73 00 76 00 63 00 73 00|"; offset:64; classtype:rpc-portmap-decode; sid:1000057;)
alert tcp anu any -> $HOME_NET 445 (msg:"SS POLICY Dir List on Remote Machine"; flags:PA; content:"|03 00|"; content:"|5c 00 63 00 24 00|"; distance:0; content:!"I.P.C."; nocase; classtype:attempted-recon; sid:1000058;)
alert tcp any any -> $HOME_NET 445 (msg:"SS POLICY Dir List on Remote Machine"; flags:PA; content:"|03 00|"; content:"|5c 00 43 00 24 00|"; distance:0; content:!"I.P.C."; nocase; classtype:attempted-recon; sid:1000050;)
alert tcp any any -> $HOME_NET 445 (msg:"SS POLICY NT Create AndX Request"; flags:PA; content:"|ff 53 4d 42 a2 00 00|"; classtype:attempted-recon; sid:1000059;)
alert tcp !$HOME_NET any -> $HOME_NET [27017,27018,27019,28017] (msg:"SS POLICY MongoDB Remote Query"; flags:PA; content:"|d4 07 00 00|"; classtype:attempted-recon; sid:1000061;)
alert tcp any any -> $HOME_NET 135 (msg:"SS POLICY DCOM RemoteGetClassObject (Potential RCE)"; flow:to_server,established; content:"|03 00|"; content:"|4d 45 4f 57 04|"; distance:0; classtype:rpc-portmap-decode; sid:1000062;)
alert tcp any any -> $HOME_NET 135 (msg:"SS POLICY DCOM Invoke Request"; flow:to_server,established; content:"|00 83|"; content:"|06 06|"; content:"|0a 05|"; content:"|36 00 00 00|"; content:"|55 73 65 72|"; classtype:rpc-portmap-decode; sid:1000062;)
alert tcp any any -> $HOME_NET any (msg:"SS POLICY Null Session Authentication"; flags:PA; content:"|4e 54 4c 4d 53 53 50 00 03 00 00 00|"; content:"|00 00 00 00 45 00 00 00|"; content:"|00 00 00 00 44 00 00 00 00 00 00 00 44 00 00 00 00 00 00 00 45 00 00 00|"; classtype:attempted-recon; sid:1000063;)
alert tcp any any -> $HOME_NET 445 (msg:"SS POLICY LSA Registry Key Query"; flags:PA; content:"|0f 00|"; content:"|53 00 59 00 53 00 54 00 45 00 4d 00 5c 00 43 00 75 00 72 00 72 00 65 00 6e 00 74 00 43 00 6f 00 6e 00 74 00 72 00 6f 00 6c 00 53 00 65 00 74 00 5c 00 43 00 6f 00 6e 00 74 00 72 00 6f 00 6c 00 5c 00 4c 00 73 00 61 00 00 00|"; classtype:attempted-recon; sid:1000064;)
alert tcp any any -> $HOME_NET 445 (msg:"SS POLICY OpenChangeSCManagerW Request ServicesActive"; flags:PA; content:"|0f 00|"; content:"|53 00 65 00 72 00 76 00 69 00 63 00 65 00 73 00 41 00 63 00 74 00 69 00 76 00 65 00 00 00|"; classtype:attempted-recon; sid:1000066;)
alert tcp any any -> [$HOME_NET,!$PROXY_SERVERS] $HTTP_PORTS (msg:"SS POLICY Possible Web Servers Reconnaissance"; flow:to_server,established; content:"GET"; http_method; content:"/wp-admin"; http_uri; detection_filter: track by_src, count 3, seconds 60; classtype:attempted-recon; sid:1000067;)
#alert tcp any any -> [$HOME_NET] [135,49150:65535] (msg:"SS POLICY Win32_Process Request"; flags:PA; content:"|57 00 69 00 6e 00 33 00 32 00 5f 00 50 00 72 00 6f 00 63 00 65 00 73 00 73 00|"; nocase; classtype:misc-attack; sid:1000068;)
alert tcp $WORKSTATIONS any -> $DC_SERVERS 88 (msg:"SS POLICY Possible Kerberoasting Attempt"; flags:PA; content:"|0c|"; content:"|01|"; content:"|40 81 00 00|"; content:"|4d 53 53 51 4c 53 76 63|"; classtype:attempted-recon; sid:1000069;)
alert tcp $HOME_NET 1433 -> any any (msg:"SS POLICY MSSQL Failed Login Attempt"; flags:PA; content:"|04|"; content:"|4c 00 6f 00 67 00 69 00 6e 00 20 00 66 00 61 00 69 00 6c 00 65 00 64 00 20 00 66 00 6f 00 72 00 20 00 75 00 73 00 65 00 72 00|"; distance:0; classtype:attempted-recon; sid:1000070;)
alert udp any any -> $HOME_NET 5060 (msg:"SS SCAN Behavioural Unusual Port 5060 traffic, Potential SIP Scan"; content:"OPTIONS"; offset:0; nocase; detection_filter: track by_src, count 3, seconds 120; classtype:attempted-recon; sid:1000071;)
alert tcp any any -> $HOME_NET any (msg:"SS POLICY NMAP NSE SCAN, Potential Scan"; content:"User-Agent: NMAP NSE"; nocase; classtype:attempted-recon; sid:1000072;)